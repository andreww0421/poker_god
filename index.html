<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#121212">
    <title>Poker God Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="icon.png" type="image/png">
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="apple-touch-icon" href="icon.png?v=11">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="header-brand">
        <img src="icon.png" alt="App Logo" class="header-logo" onerror="this.style.display='none'">
        <h1>Poker God <span style="font-size:0.5em; opacity:0.8; background:none; -webkit-text-fill-color: var(--text-main);">PRO</span></h1>
    </div>
    <div class="version-tag">v5.9.6</div>
</header>

<div class="container">
    <div id="tab-ranges" class="tab-content active">
        <div class="card-panel">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <select id="gameMode" onchange="updateRanges()">
                    <option value="MTT" data-i18n="mode_mtt">MTT</option>
                    <option value="Cash" data-i18n="mode_cash">Cash (RFI)</option>
                    <option value="Cash_vs_3Bet">Cash (Face 3-Bet)</option>
                </select>
                <select id="playerCount" onchange="updateRanges()">
                    <option value="2">2 Max</option><option value="3">3 Max</option><option value="4">4 Max</option><option value="5">5 Max</option>
                    <option value="6">6 Max</option><option value="7">7 Max</option><option value="8">8 Max</option><option value="9" selected>9 Max (Full Ring)</option><option value="10">10 Max</option>
                </select>
                <select id="heroPosition" onchange="updateRanges()">
                    <option value="BTN">BTN</option><option value="CO">CO</option><option value="MP">MP</option><option value="EP">EP/UTG</option><option value="SB">SB</option><option value="BB">BB</option>
                </select>
                <input type="number" id="stackDepth" value="100" placeholder="BB" onchange="updateRanges()">
            </div>
            <div style="margin-top:10px; font-size:0.8rem; color:var(--text-muted); font-style:italic;" id="rangeInfoText"></div>
        </div>
        <div class="card-panel">
            <label data-i18n="mixed_chart">æ··åˆç­–ç•¥åœ–</label>
            <div class="chart-container" id="rangeGrid"></div>
            <div style="display:flex; justify-content:center; gap:10px; margin-top:10px; font-size:0.75rem; color:var(--text-muted); flex-wrap:wrap;">
                <span style="display:flex; align-items:center;"><div class="legend-dot" style="background:var(--c-allin)"></div> All-in</span>
                <span style="display:flex; align-items:center;"><div class="legend-dot" style="background:var(--c-raise)"></div> Raise</span>
                <span style="display:flex; align-items:center;"><div class="legend-dot" style="background:var(--c-call)"></div> Call</span>
                <span style="display:flex; align-items:center;"><div class="legend-dot" style="background:var(--c-fold)"></div> Fold</span>
            </div>
        </div>
    </div>

    <div id="tab-trainer" class="tab-content">
        <div class="card-panel">
            <div class="trainer-stats"><span><span data-i18n="streak">é€£å‹</span>: <span id="trStreak" style="color:var(--accent)">0</span></span><span><span data-i18n="score">å¾—åˆ†</span>: <span id="trScore">0/0</span></span></div>
            <div style="text-align:center; margin-bottom:20px;">
                <div style="font-size:1.1rem; font-weight:bold; margin-bottom:5px;" id="trScenario">Loading...</div>
                <div style="color:var(--text-muted); font-size:0.9rem;" data-i18n="gto_action_q">What is the GTO action?</div>
            </div>
            <div class="hand-display"><div class="poker-card selected" id="trCard1"></div><div class="poker-card selected" id="trCard2"></div></div>
            <div class="trainer-grid">
                <button class="btn-action" style="background:var(--c-fold); margin:0;" onclick="checkTrainer('fold')" data-i18n="fold">Fold</button>
                <button class="btn-action" style="background:var(--c-call); color:black; margin:0;" onclick="checkTrainer('call')" data-i18n="call">Call</button>
                <button class="btn-action" style="background:var(--c-raise); margin:0;" onclick="checkTrainer('raise')" data-i18n="raise">Raise</button>
            </div>
            <div id="trFeedback" class="trainer-feedback"></div>
            <button id="trNextBtn" class="btn-action" style="display:none; background:var(--bg-body); color:var(--text-main); border:1px solid var(--border);" onclick="nextDrill()" data-i18n="next_hand">Next Hand â”</button>
        </div>
    </div>

    <div id="tab-odds" class="tab-content">
        <div class="card-panel">
            <label data-i18n="pot_odds_calc">åº•æ± è³ ç‡è¨ˆç®—</label>
            <div class="input-group"><label data-i18n="pot">åº•æ±  (Pot)</label><input type="number" id="potSize" placeholder="1000"></div>
            <div class="input-group"><label data-i18n="bet_call">è·Ÿæ³¨ (Call Amount)</label><input type="number" id="betSize" placeholder="500"></div>
            <button class="btn-action" onclick="calcPotOdds()" data-i18n="calculate">è¨ˆç®—</button>
            <div class="result-box" id="oddsResult" style="display:none;">
                <div class="result-label" data-i18n="req_equity">æ‰€éœ€å‹ç‡</div><div class="result-val" id="reqEquity">--%</div>
                <div class="result-label" style="margin-top:10px;" data-i18n="odds">è³ ç‡</div><div style="color:var(--text-main); font-size:1.2rem;" id="oddsRatio">-- : 1</div>
            </div>
        </div>
    </div>

    <div id="tab-postflop" class="tab-content">
        <div class="card-panel">
            <label data-i18n="my_hand">æˆ‘çš„æ‰‹ç‰Œ</label>
            <div class="hand-display">
                <div class="poker-card empty" id="card_h1" onclick="sel('h1')">+</div>
                <div class="poker-card empty" id="card_h2" onclick="sel('h2')">+</div>
            </div>
            <label style="margin-top:15px;" data-i18n="board">å…¬å…±ç‰Œ</label>
            <div class="hand-display" style="gap:5px;">
                <div class="poker-card empty" style="width:40px;height:60px;font-size:1rem;" id="card_b1" onclick="sel('b1')"></div>
                <div class="poker-card empty" style="width:40px;height:60px;font-size:1rem;" id="card_b2" onclick="sel('b2')"></div>
                <div class="poker-card empty" style="width:40px;height:60px;font-size:1rem;" id="card_b3" onclick="sel('b3')"></div>
                <div class="poker-card empty" style="width:40px;height:60px;font-size:1rem;" id="card_b4" onclick="sel('b4')"></div>
                <div class="poker-card empty" style="width:40px;height:60px;font-size:1rem;" id="card_b5" onclick="sel('b5')"></div>
            </div>
            <label style="margin-top:20px; border-top:1px solid var(--border); padding-top:15px;" data-i18n="opp_action">å°æ‰‹è¡Œå‹•</label>
            <div class="opp-action-grid">
                <button class="btn-opp" onclick="setOppAction('check', this)">Check</button>
                <button class="btn-opp" onclick="setOppAction('bet', this)">Bet</button>
                <button class="btn-opp" onclick="setOppAction('raise', this)">Raise</button>
                <button class="btn-opp" onclick="setOppAction('3bet', this)">3-Bet</button>
                <button class="btn-opp" onclick="setOppAction('allin', this)" style="grid-column: span 2; color:var(--danger); border-color:var(--danger);">All-in</button>
            </div>
            
            <div style="display:flex; gap:10px;">
                <button class="btn-action" onclick="analyzePostflop()" data-i18n="analyze" style="flex:3;">AI åˆ†ææ±ºç­–</button>
                <button class="btn-action" onclick="resetPostflop()" style="flex:1; background:var(--c-fold);">â†º</button>
            </div>

            <div class="result-box" id="postflopResult" style="display:none;">
                <div class="result-label" data-i18n="hand_strength">ç‰ŒåŠ›å¼·åº¦</div>
                <div class="meter-bg"><div class="meter-fill" id="strengthBar"></div></div>
                <span class="category-badge" id="handCategory">--</span>
                <div class="ai-advice-text" id="aiAdvice"></div>
            </div>
        </div>
    </div>

    <div id="tab-bankroll" class="tab-content">
        <div class="filter-tabs">
            <div class="filter-tab active" onclick="setFilter('ALL', this)" data-i18n="all">å…¨éƒ¨</div>
            <div class="filter-tab" onclick="setFilter('MTT', this)">MTT</div>
            <div class="filter-tab" onclick="setFilter('Cash', this)">Cash</div>
        </div>
        <div class="card-panel">
            <label data-i18n="bankroll_trend">è³‡é‡‘è¶¨å‹¢</label>
            <div class="stats-grid">
                <div class="stat-card"><span class="stat-label" data-i18n="total_sessions">ç¸½å ´æ¬¡</span><div class="stat-val" id="statSessions">0</div></div>
                <div class="stat-card"><span class="stat-label" data-i18n="win_rate">å‹ç‡</span><div class="stat-val" id="statWinRate">0%</div></div>
                <div class="stat-card"><span class="stat-label" data-i18n="invested">ç¸½æŠ•å…¥</span><div class="stat-val" id="statInvested">0</div></div>
                <div class="stat-card"><span class="stat-label" data-i18n="revenue">ç¸½å›å ±</span><div class="stat-val" id="statRevenue">0</div></div>
                <div class="stat-card span-2"><span class="stat-label">ROI</span><div class="stat-val" id="statROI">0%</div></div>
            </div>
            <canvas id="bankrollCanvas"></canvas>
            <div class="total-profit-box"><span class="tp-label" data-i18n="total_profit">ç¸½ç›ˆè™§</span><div id="bigTotalProfit" class="tp-value">0</div></div>
        </div>
        <div class="card-panel">
            <label data-i18n="add_record">æ–°å¢ç´€éŒ„</label>
            <div class="row-group"><input type="date" id="brDate" style="flex:2"><select id="brType" style="flex:1"><option value="MTT" data-i18n="mode_mtt">MTT</option><option value="Cash" data-i18n="mode_cash">Cash</option></select></div>
            <div class="input-group" style="margin-top:10px;"><input type="text" id="brName" list="brNameList" placeholder="Name" data-placeholder-i18n="placeholder_name"><datalist id="brNameList"></datalist></div>
            <div class="input-group" style="margin-top:10px;"><input type="text" id="brNote" placeholder="Note (Optional)" data-placeholder-i18n="placeholder_note"></div>
            <div class="row-group" style="margin-top:10px;">
                <div style="flex:1"><label data-i18n="buyin">è²·å…¥</label><input type="number" id="brBuyIn" placeholder="0" oninput="calcPreview()"></div>
                <div style="flex:1"><label data-i18n="prize">çé‡‘</label><input type="number" id="brPrize" placeholder="0" oninput="calcPreview()"></div>
            </div>
            <div style="text-align:right; margin-top:5px; font-size:0.85rem; color:var(--text-muted);"><span data-i18n="profit">ç›ˆåˆ©</span>: <span id="brProfitPreview" style="font-weight:bold; color:var(--text-main);">0</span></div>
            <button class="btn-action" onclick="addBankroll()" data-i18n="save">å„²å­˜</button>
        </div>
        <div class="card-panel"><label data-i18n="history">æ­·å²ç´€éŒ„</label><div id="historyList" style="max-height:300px; overflow-y:auto;"></div></div>
    </div>
</div>

<div class="fab-wrapper">
    <div class="fab-menu" id="fabMenu">
        <div class="fab-item" onclick="toggleHaptic()"><span id="hapticIcon">ğŸ“³</span> <span id="hapticLabel" data-i18n="haptic_on">éœ‡å‹• (On)</span></div>
        <div class="fab-item" onclick="toggleTheme()"><span>ğŸŒ—</span> <span data-i18n="theme_toggle">åˆ‡æ›ä¸»é¡Œ (Theme)</span></div>
        <div class="fab-item" onclick="openLangModal()"><span>ğŸŒ</span> <span data-i18n="language">èªè¨€ (Language)</span></div>
        <div class="fab-item" onclick="exportData()" data-i18n="export">åŒ¯å‡ºå‚™ä»½</div>
        <div class="fab-item" onclick="document.getElementById('importFile').click()" data-i18n="import">é‚„åŸè³‡æ–™</div>
    </div>
    <button class="fab-btn" onclick="toggleFab()">â˜°</button>
</div>
<input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(this)">

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('ranges', this)"><span class="nav-icon">ğŸ“Š</span><span class="nav-label" data-i18n="nav_ranges">Ranges</span></div>
    <div class="nav-item" onclick="switchTab('trainer', this)"><span class="nav-icon">ğŸ“</span><span class="nav-label" data-i18n="nav_trainer">Trainer</span></div>
    <div class="nav-item" onclick="switchTab('odds', this)"><span class="nav-icon">ğŸ§®</span><span class="nav-label" data-i18n="nav_odds">Odds</span></div>
    <div class="nav-item" onclick="switchTab('postflop', this)"><span class="nav-icon">â™ ï¸</span><span class="nav-label" data-i18n="nav_postflop">Postflop</span></div>
    <div class="nav-item" onclick="switchTab('bankroll', this)"><span class="nav-icon">ğŸ’°</span><span class="nav-label" data-i18n="nav_bankroll">Bankroll</span></div>
</div>

<div class="modal" id="cardModal">
    <div class="modal-content">
        <h3 style="margin:0 0 15px 0; color:var(--text-main);" data-i18n="select_card">Select Card</h3>
        <div id="suit-spades" class="suit-row"></div><div id="suit-hearts" class="suit-row"></div>
        <div id="suit-clubs" class="suit-row"></div><div id="suit-diamonds" class="suit-row"></div>
        <button onclick="closeSel()" style="width:100%; margin-top:10px; padding:10px; background:rgba(125,125,125,0.2); border:none; color:var(--text-main); border-radius:4px;" data-i18n="cancel">Cancel</button>
    </div>
</div>

<div class="modal" id="langModal">
    <div class="modal-content">
        <h3 style="margin:0 0 15px 0; color:var(--text-main);" data-i18n="language">Language</h3>
        <div class="lang-option" onclick="changeLang('zh-TW')">ç¹é«”ä¸­æ–‡</div>
        <div class="lang-option" onclick="changeLang('zh-CN')">ç®€ä½“ä¸­æ–‡</div>
        <div class="lang-option" onclick="changeLang('en')">English</div>
        <div class="lang-option" onclick="changeLang('ja')">æ—¥æœ¬èª</div>
        <div class="lang-option" onclick="changeLang('ko')">í•œêµ­ì–´</div>
        <button onclick="document.getElementById('langModal').style.display='none'" style="width:100%; margin-top:10px; padding:10px; background:rgba(125,125,125,0.2); border:none; color:var(--text-main); border-radius:4px;" data-i18n="cancel">Cancel</button>
    </div>
</div>

<script src="app.js"></script>
</body>
</html>

