<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#121212">
    <title>Poker God Pro</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="./icon.png">
    <link rel="apple-touch-icon" href="./icon.png">
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: rgba(30, 41, 59, 0.7);
            --accent: #10b981; /* Emerald Green */
            --accent-glow: rgba(16, 185, 129, 0.3);
            --danger: #ef4444;
            --warning: #f59e0b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: rgba(255,255,255,0.1);
            --chart-line: #3b82f6;
            --chart-grid: rgba(255,255,255,0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 10% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 20%);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            padding-bottom: 90px; /* Space for bottom nav */
            min-height: 100vh;
        }

        /* Header */
        header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            position: sticky; top: 0; z-index: 50;
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
        }
        h1 { margin: 0; font-size: 1.2rem; font-weight: 800; letter-spacing: 0.5px; background: linear-gradient(to right, #10b981, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Container & Grid */
        .container { max-width: 600px; margin: 0 auto; padding: 15px; }
        
        /* Cards & Panels */
        .card-panel {
            background: var(--bg-panel);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        /* Inputs */
        .input-group { margin-bottom: 12px; }
        .row-group { display: flex; gap: 10px; }
        label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 6px; display: block; }
        select, input {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            color: white; padding: 12px; border-radius: 8px; font-size: 1rem; outline: none; transition: border 0.2s;
        }
        select:focus, input:focus { border-color: var(--accent); }

        /* Poker Cards Visuals */
        .hand-display { display: flex; gap: 12px; justify-content: center; margin: 15px 0; }
        .poker-card {
            width: 55px; height: 78px; background: #e2e8f0; border-radius: 6px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; font-size: 1.3rem; cursor: pointer; position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .poker-card:active { transform: scale(0.95); }
        .poker-card.empty { background: rgba(255,255,255,0.05); border: 2px dashed var(--text-muted); color: var(--text-muted); box-shadow: none; }
        .poker-card.selected { border: 2px solid var(--accent); background: white; }
        
        /* Suit Colors */
        .suit-s { color: #1e293b; }
        .suit-h { color: #ef4444; }
        .suit-c { color: #10b981; }
        .suit-d { color: #3b82f6; }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
            display: flex; justify-content: space-around;
            padding: 10px 0; z-index: 100;
        }
        .nav-item {
            color: var(--text-muted); text-align: center; font-size: 0.7rem; cursor: pointer;
            flex: 1; padding: 5px; opacity: 0.7; transition: 0.2s;
        }
        .nav-item.active { color: var(--accent); opacity: 1; transform: translateY(-2px); }
        .nav-icon { font-size: 1.4rem; display: block; margin-bottom: 4px; }

        /* Sections (Tabs) */
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* 13x13 Grid */
        .chart-container {
            display: grid; grid-template-columns: repeat(13, 1fr); gap: 1px;
            background: #000; padding: 1px; border-radius: 4px; overflow: hidden;
        }
        .chart-cell {
            aspect-ratio: 1; font-size: 0.55rem; display: flex; align-items: center; justify-content: center;
            background: #2d3748; color: #718096; cursor: default;
        }
        .chart-cell.bg-raise { background: var(--danger); color: white; }
        .chart-cell.bg-call { background: var(--warning); color: black; }
        .chart-cell.active { border: 2px solid white; z-index: 10; }

        /* Calculator Results */
        .result-box {
            text-align: center; margin-top: 15px; padding: 15px;
            background: rgba(0,0,0,0.2); border-radius: 8px;
        }
        .result-val { font-size: 1.8rem; font-weight: bold; color: var(--accent); }
        .result-label { color: var(--text-muted); font-size: 0.8rem; }
        
        .btn-action {
            width: 100%; padding: 14px; background: var(--accent); color: #000;
            border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; cursor: pointer;
            box-shadow: 0 4px 15px var(--accent-glow); margin-top: 10px;
        }
        .btn-delete { background: transparent; color: var(--danger); border: 1px solid var(--danger); padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }

        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 200; justify-content: center; align-items: center; }
        .modal-content { background: #1e293b; padding: 20px; border-radius: 16px; width: 90%; max-width: 350px; border: 1px solid var(--border); }
        .suit-row { display: flex; gap: 5px; margin-bottom: 8px; }
        .rank-btn { flex: 1; padding: 10px 0; background: #334155; border: none; color: white; border-radius: 4px; font-weight: bold; }

        /* Bankroll Chart */
        canvas#bankrollCanvas { width: 100%; height: 220px; background: rgba(0,0,0,0.2); border-radius: 8px; margin-bottom: 10px; }
        .history-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .history-val { font-weight: bold; font-family: monospace; font-size: 1.1rem; }
        .pos-val { color: var(--accent); }
        .neg-val { color: var(--danger); }
    </style>
</head>
<body>

<header>
    <h1>Poker God <span style="font-size:0.5em; opacity:0.8; color:white; background:none;">PRO</span></h1>
    <div style="font-size:0.8rem; color:var(--text-muted);">v2.0</div>
</header>

<div class="container">
    
    <div id="tab-ranges" class="tab-content active">
        <div class="card-panel">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <select id="gameMode" onchange="updateRanges()"><option value="MTT">éŒ¦æ¨™è³½ (MTT)</option><option value="Cash">ç¾é‡‘æ¡Œ (Cash)</option></select>
                <select id="playerCount" onchange="updateRanges()">
                    <option value="10">10äºº (Full Ring+)</option>
                    <option value="9" selected>9äºº (Full Ring)</option>
                    <option value="8">8äºº Table</option>
                    <option value="7">7äºº Table</option>
                    <option value="6">6äºº (6-Max)</option>
                    <option value="5">5äºº Table</option>
                    <option value="4">4äºº Table</option>
                    <option value="3">3äºº Table</option>
                    <option value="2">2äºº (Heads Up)</option>
                </select>
                <select id="heroPosition" onchange="updateRanges()">
                    <option value="BTN">BTN</option><option value="CO">CO</option><option value="MP">MP</option><option value="EP">EP/UTG</option><option value="SB">SB</option><option value="BB">BB</option>
                </select>
                <input type="number" id="stackDepth" value="100" placeholder="BB" onchange="updateRanges()">
            </div>
        </div>

        <div class="card-panel">
            <label>13x13 èµ·æ‰‹ç‰Œç†±åŠ›åœ– (RFI / Strategy)</label>
            <div class="chart-container" id="rangeGrid"></div>
            <div style="display:flex; justify-content:center; gap:15px; margin-top:10px; font-size:0.75rem; color:var(--text-muted);">
                <span style="color:var(--danger)">â— Raise/All-in</span>
                <span style="color:var(--warning)">â— Call/Mix</span>
                <span style="color:#718096">â— Fold</span>
            </div>
        </div>
    </div>

    <div id="tab-odds" class="tab-content">
        <div class="card-panel">
            <label>åº•æ± è³ ç‡è¨ˆç®—æ©Ÿ (Pot Odds)</label>
            <div class="input-group">
                <label>ç•¶å‰åº•æ± å¤§å° (Current Pot)</label>
                <input type="number" id="potSize" placeholder="ä¾‹å¦‚: 1000">
            </div>
            <div class="input-group">
                <label>å°æ–¹ä¸‹æ³¨é‡‘é¡ / è·Ÿæ³¨é‡‘é¡ (Bet to Call)</label>
                <input type="number" id="betSize" placeholder="ä¾‹å¦‚: 500">
            </div>
            <button class="btn-action" onclick="calcPotOdds()">è¨ˆç®—è³ ç‡ (Calculate)</button>

            <div class="result-box" id="oddsResult" style="display:none;">
                <div class="result-label">ä½ éœ€è¦å¤šå°‘å‹ç‡ (Required Equity)</div>
                <div class="result-val" id="reqEquity">--%</div>
                <hr style="border:0; border-top:1px solid rgba(255,255,255,0.1); margin:10px 0;">
                <div class="result-label">è³ ç‡ (Odds)</div>
                <div style="color:white; font-size:1.2rem;" id="oddsRatio">-- : 1</div>
            </div>
        </div>
    </div>

    <div id="tab-postflop" class="tab-content">
        <div class="card-panel">
            <label>æ‰‹ç‰Œ (My Hand)</label>
            <div class="hand-display">
                <div class="poker-card empty" id="card_h1" onclick="sel('h1')">+</div>
                <div class="poker-card empty" id="card_h2" onclick="sel('h2')">+</div>
            </div>
            
            <label style="margin-top:15px;">å…¬å…±ç‰Œ (Board - Flop/Turn)</label>
            <div class="hand-display" style="gap:5px;">
                <div class="poker-card empty" style="width:40px; height:60px; font-size:1rem;" id="card_b1" onclick="sel('b1')"></div>
                <div class="poker-card empty" style="width:40px; height:60px; font-size:1rem;" id="card_b2" onclick="sel('b2')"></div>
                <div class="poker-card empty" style="width:40px; height:60px; font-size:1rem;" id="card_b3" onclick="sel('b3')"></div>
                <div class="poker-card empty" style="width:40px; height:60px; font-size:1rem;" id="card_b4" onclick="sel('b4')"></div>
            </div>

            <button class="btn-action" onclick="calcPostflop()">åˆ†æç¿»å¾Œå‹ç‡ (Analyze)</button>
            
            <div class="result-box" id="postflopResult" style="display:none;">
                <div class="result-label">ä¼°è¨ˆè£œç‰Œæ•¸ (Outs)</div>
                <div style="font-size:1.5rem; color:white;" id="outsVal">0</div>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                    <div>
                        <div class="result-label">è½‰ç‰Œä¸­ç‰Œç‡</div>
                        <div class="result-val" style="font-size:1.2rem;" id="turnEquity">--%</div>
                    </div>
                    <div>
                        <div class="result-label">æ²³ç‰Œä¸­ç‰Œç‡</div>
                        <div class="result-val" style="font-size:1.2rem;" id="riverEquity">--%</div>
                    </div>
                </div>
                <div style="margin-top:10px; font-size:0.8rem; color:#aaa; font-style:italic;" id="drawDesc"></div>
            </div>
        </div>
    </div>

    <div id="tab-bankroll" class="tab-content">
        <div class="card-panel">
            <label>è³‡é‡‘è¶¨å‹¢åœ– (Bankroll Trend)</label>
            <canvas id="bankrollCanvas"></canvas>
            <div style="display:flex; justify-content:space-between; margin-top:5px;">
                <span class="result-label">ç¸½ç›ˆè™§: <span id="totalProfit" style="color:white; font-weight:bold;">0</span></span>
                <span class="result-label">å ´æ¬¡: <span id="totalGames">0</span></span>
            </div>
        </div>

        <div class="card-panel">
            <label>æ–°å¢ç´€éŒ„ (Add Record)</label>
            <div class="row-group">
                <input type="date" id="brDate">
                <select id="brType">
                    <option value="MTT">MTT</option>
                    <option value="Cash">Cash</option>
                </select>
            </div>
            <div class="input-group" style="margin-top:10px;">
                <label>ç›ˆè™§é‡‘é¡ (Profit/Loss) <small style="color:#666">è² æ•¸ä»£è¡¨è™§æ</small></label>
                <input type="number" id="brAmount" placeholder="ä¾‹å¦‚: +1000 æˆ– -500">
            </div>
            <button class="btn-action" onclick="addBankroll()">æ–°å¢ç´€éŒ„ (Save)</button>
        </div>

        <div class="card-panel">
            <label>æ­·å²ç´€éŒ„ (History)</label>
            <div id="historyList" style="max-height:300px; overflow-y:auto;">
                </div>
        </div>
    </div>

</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('ranges', this)">
        <span class="nav-icon">ğŸ“Š</span> Ranges
    </div>
    <div class="nav-item" onclick="switchTab('odds', this)">
        <span class="nav-icon">ğŸ§®</span> Pot Odds
    </div>
    <div class="nav-item" onclick="switchTab('postflop', this)">
        <span class="nav-icon">â™ ï¸</span> Postflop
    </div>
    <div class="nav-item" onclick="switchTab('bankroll', this)">
        <span class="nav-icon">ğŸ’°</span> Bankroll
    </div>
</div>

<div class="modal" id="cardModal">
    <div class="modal-content">
        <h3 style="margin:0 0 15px 0; color:white;">Select Card</h3>
        <div id="suit-spades" class="suit-row"></div>
        <div id="suit-hearts" class="suit-row"></div>
        <div id="suit-clubs" class="suit-row"></div>
        <div id="suit-diamonds" class="suit-row"></div>
        <button onclick="closeSel()" style="width:100%; margin-top:10px; padding:10px; background:rgba(255,255,255,0.1); border:none; color:white; border-radius:4px;">Cancel</button>
    </div>
</div>

<script>
    // --- APP STATE ---
    const state = { h1: null, h2: null, b1:null, b2:null, b3:null, b4:null };
    let curSel = null;
    const ranks = ['A','K','Q','J','T','9','8','7','6','5','4','3','2'];
    let bankrollData = JSON.parse(localStorage.getItem('pokerGodBankroll') || '[]');

    // --- INITIALIZATION ---
    window.onload = () => {
        genGrid();
        genSelUI();
        updateRanges();
        
        // Init Date Input
        document.getElementById('brDate').valueAsDate = new Date();
        
        // Render Bankroll
        renderBankrollUI();

        // SW Register
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').catch(e=>console.log(e));
        }
    };

    // --- TAB SYSTEM ---
    function switchTab(tabId, navEl) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        navEl.classList.add('active');
    }

    // --- LOGIC: RANGES ---
    function genGrid() {
        const c = document.getElementById('rangeGrid');
        c.innerHTML = '';
        for(let i=0; i<13; i++) {
            for(let j=0; j<13; j++) {
                let div = document.createElement('div');
                div.className = 'chart-cell';
                let txt = i===j ? ranks[i]+ranks[j] : (i<j ? ranks[i]+ranks[j]+'s' : ranks[j]+ranks[i]+'o');
                div.innerText = txt;
                div.dataset.h = txt;
                div.id = `cell-${i}-${j}`;
                c.appendChild(div);
            }
        }
    }

    function updateRanges() {
        const pos = document.getElementById('heroPosition').value;
        const stack = parseInt(document.getElementById('stackDepth').value);
        const players = parseInt(document.getElementById('playerCount').value); // 2-10
        
        let score = 0; 
        if(pos==='BTN') score=5; else if(pos==='CO') score=3; else if(pos==='MP') score=1;
        if(document.getElementById('gameMode').value === 'MTT') score += 1;
        
        // Player Count Logic Adjustments
        if(players <= 3) score += 2; // Looser in Short Handed
        else if(players <= 6) score += 1;

        if(stack < 15) score = -10; // Push Fold

        const cells = document.querySelectorAll('.chart-cell');
        cells.forEach(cell => {
            let h = cell.dataset.h;
            let act = 0; // 0:Fold, 1:Call, 2:Raise
            
            if(stack < 15) { // Push Fold logic
                if(h.includes('A') || h[0]===h[1] || (h.includes('K') && h.includes('s'))) act=2;
            } else {
                if(h[0]===h[1]) act = (ranks.indexOf(h[0]) < 8 + score) ? 2 : 0; 
                else if(h.includes('s')) act = (ranks.indexOf(h[0]) < 5 + score && ranks.indexOf(h[1]) < 9 + score) ? 2 : 0;
                else if(h.includes('o')) act = (ranks.indexOf(h[0]) < 3 + score && ranks.indexOf(h[1]) < 5) ? 2 : 0;
                
                if(act===0 && score > 3 && h.includes('s')) act=1; 
            }
            cell.className = 'chart-cell ' + (act===2 ? 'bg-raise' : (act===1 ? 'bg-call' : ''));
        });
    }

    // --- LOGIC: POT ODDS ---
    function calcPotOdds() {
        let pot = parseFloat(document.getElementById('potSize').value);
        let call = parseFloat(document.getElementById('betSize').value);
        if(!pot || !call) return;
        let totalPot = pot + call + call; 
        let reqEquity = (call / totalPot) * 100;
        let ratio = (pot + call) / call;
        document.getElementById('oddsResult').style.display = 'block';
        document.getElementById('reqEquity').innerText = reqEquity.toFixed(1) + '%';
        document.getElementById('oddsRatio').innerText = ratio.toFixed(1) + ' : 1';
    }

    // --- LOGIC: POSTFLOP ---
    function calcPostflop() {
        if(!state.h1 || !state.h2 || !state.b1 || !state.b2 || !state.b3) {
            alert("è«‹é¸æ“‡æ‰‹ç‰Œèˆ‡è‡³å°‘ä¸‰å¼µå…¬ç‰Œ (Flop)"); return;
        }
        let cards = [state.h1, state.h2, state.b1, state.b2, state.b3];
        if(state.b4) cards.push(state.b4);
        
        let suits = {'s':0, 'h':0, 'c':0, 'd':0};
        cards.forEach(c => suits[c.suit.id]++);
        
        let outs = 0; let desc = [];
        for(let s in suits) { if(suits[s] === 4) { outs += 9; desc.push("Flush Draw"); } }
        if(state.h1.rank !== state.h2.rank) outs += 6; else outs += 2;
        if(outs > 15) outs = 15;
        
        document.getElementById('postflopResult').style.display = 'block';
        document.getElementById('outsVal').innerText = outs;
        document.getElementById('turnEquity').innerText = (outs * 4) + '%';
        document.getElementById('riverEquity').innerText = (outs * 2) + '%';
        document.getElementById('drawDesc').innerText = desc.join(', ') || "High Card / Pair";
    }

    // --- LOGIC: BANKROLL & CHART ---
    function addBankroll() {
        const date = document.getElementById('brDate').value;
        const type = document.getElementById('brType').value;
        const amt = parseFloat(document.getElementById('brAmount').value);
        
        if(!date || isNaN(amt)) { alert("è«‹è¼¸å…¥æ—¥æœŸèˆ‡é‡‘é¡"); return; }
        
        bankrollData.push({ id: Date.now(), date, type, amount: amt });
        localStorage.setItem('pokerGodBankroll', JSON.stringify(bankrollData));
        
        document.getElementById('brAmount').value = ''; // clear
        renderBankrollUI();
    }

    function deleteRecord(id) {
        if(!confirm("ç¢ºå®šåˆªé™¤æ­¤ç´€éŒ„?")) return;
        bankrollData = bankrollData.filter(item => item.id !== id);
        localStorage.setItem('pokerGodBankroll', JSON.stringify(bankrollData));
        renderBankrollUI();
    }

    function renderBankrollUI() {
        const list = document.getElementById('historyList');
        list.innerHTML = '';
        
        let total = 0;
        let cumulativeData = []; // for chart [ {x:0, y:0}, {x:1, y:500} ... ]
        cumulativeData.push({x:0, y:0}); // start at 0

        // Sort by date (optional, strictly speaking input order might be better for chronological chart if user inputs backlog)
        // Let's assume input order for now or sort by ID/Date
        // bankrollData.sort((a,b) => new Date(a.date) - new Date(b.date));

        bankrollData.forEach((item, index) => {
            total += item.amount;
            cumulativeData.push({ x: index+1, y: total });

            let el = document.createElement('div');
            el.className = 'history-item';
            el.innerHTML = `
                <div>
                    <div style="font-size:0.85rem; color:#ccc;">${item.date} <span style="background:#333; padding:2px 4px; border-radius:3px; font-size:0.7rem;">${item.type}</span></div>
                </div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span class="history-val ${item.amount>=0?'pos-val':'neg-val'}">${item.amount>=0?'+':''}${item.amount}</span>
                    <button class="btn-delete" onclick="deleteRecord(${item.id})">âœ•</button>
                </div>
            `;
            list.prepend(el); // Newest top
        });

        document.getElementById('totalProfit').innerText = (total>=0?'+':'') + total;
        document.getElementById('totalProfit').style.color = total>=0 ? 'var(--accent)' : 'var(--danger)';
        document.getElementById('totalGames').innerText = bankrollData.length;

        drawChart(cumulativeData);
    }

    function drawChart(data) {
        const canvas = document.getElementById('bankrollCanvas');
        const ctx = canvas.getContext('2d');
        // Fit canvas to container
        const rect = canvas.parentElement.getBoundingClientRect();
        canvas.width = rect.width; 
        canvas.height = 220;
        
        const w = canvas.width;
        const h = canvas.height;
        const padding = 20;

        // Clear
        ctx.clearRect(0, 0, w, h);
        
        if(data.length < 2) {
            ctx.fillStyle = "#666"; ctx.font = "14px Arial"; ctx.textAlign = "center";
            ctx.fillText("å°šç„¡è¶³å¤ æ•¸æ“šç¹ªè£½åœ–è¡¨ (No Data)", w/2, h/2);
            return;
        }

        // Find Scale
        let maxY = -Infinity, minY = Infinity;
        data.forEach(p => { if(p.y > maxY) maxY = p.y; if(p.y < minY) minY = p.y; });
        // Add padding to Y
        let range = maxY - minY;
        if(range === 0) range = 100; // prevent zero division
        maxY += range * 0.1; minY -= range * 0.1;

        const mapX = (i) => padding + (i / (data.length - 1)) * (w - padding * 2);
        const mapY = (val) => h - (padding + ((val - minY) / (maxY - minY)) * (h - padding * 2));

        // Draw Zero Line
        if(minY < 0 && maxY > 0) {
            let zeroY = mapY(0);
            ctx.beginPath(); ctx.strokeStyle = "rgba(255,255,255,0.2)"; ctx.setLineDash([5, 5]);
            ctx.moveTo(padding, zeroY); ctx.lineTo(w-padding, zeroY); ctx.stroke(); ctx.setLineDash([]);
        }

        // Draw Line
        ctx.beginPath();
        ctx.strokeStyle = "#3b82f6"; ctx.lineWidth = 3;
        ctx.moveTo(mapX(0), mapY(data[0].y));
        
        for(let i=1; i<data.length; i++) {
            ctx.lineTo(mapX(i), mapY(data[i].y));
        }
        ctx.stroke();

        // Draw Gradient Area
        ctx.lineTo(mapX(data.length-1), h);
        ctx.lineTo(mapX(0), h);
        ctx.closePath();
        let grad = ctx.createLinearGradient(0, 0, 0, h);
        grad.addColorStop(0, "rgba(59, 130, 246, 0.3)");
        grad.addColorStop(1, "rgba(59, 130, 246, 0.0)");
        ctx.fillStyle = grad;
        ctx.fill();

        // Draw Points
        data.forEach((p, i) => {
            let px = mapX(i); let py = mapY(p.y);
            ctx.beginPath(); ctx.fillStyle = "#fff";
            ctx.arc(px, py, 3, 0, Math.PI*2); ctx.fill();
        });
    }

    // --- UI HELPERS ---
    function genSelUI() {
        const suits = [{id:'s',s:'â™ ',c:'suit-s'},{id:'h',s:'â™¥',c:'suit-h'},{id:'c',s:'â™£',c:'suit-c'},{id:'d',s:'â™¦',c:'suit-d'}];
        suits.forEach(s => {
            let row = document.getElementById('suit-'+(s.id==='s'?'spades':s.id==='h'?'hearts':s.id==='c'?'clubs':'diamonds'));
            ['A','K','Q','J','T','9','8'].forEach(r => { 
                let b = document.createElement('button'); b.className=`rank-btn ${s.c}`; b.innerText=r+s.s;
                b.onclick=()=>{ setCard(r, s); }; row.appendChild(b);
            });
        });
    }
    
    function sel(id) { curSel=id; document.getElementById('cardModal').style.display='flex'; }
    function closeSel() { document.getElementById('cardModal').style.display='none'; }
    function setCard(r,s) {
        state[curSel] = {rank:r, suit:s};
        let el = document.getElementById('card_'+curSel);
        el.className = 'poker-card selected';
        el.innerHTML = `<span class="${s.c}">${s.s}</span><span>${r}</span>`;
        closeSel();
    }
</script>

</body>
</html>
