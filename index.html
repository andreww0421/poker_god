<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Poker God Pro v6.0 - Advanced GTO Solver & Trainer">
    <title>Poker God Pro v6.0</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --bg-body: #0f172a;
            --bg-panel: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: rgba(255,255,255,0.1);
            --accent: #3b82f6; /* Blue for Pro feel */
            --accent-hover: #2563eb;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --nav-bg: rgba(15, 23, 42, 0.98);
            --c-raise: #10b981; 
            --c-call: #eab308; 
            --c-allin: #ef4444; 
            --c-fold: #334155;
            --card-bg: #e2e8f0;
            --card-text: #000;
        }
        [data-theme="light"] {
            --bg-body: #f8fafc;
            --bg-panel: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --nav-bg: rgba(255, 255, 255, 0.98);
            --c-fold: #cbd5e1;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding-bottom: 80px; min-height: 100vh; transition: 0.3s; }
        
        /* Header */
        header { background: var(--bg-panel); padding: 12px 20px; position: sticky; top: 0; z-index: 50; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h1 { margin: 0; font-size: 1.3rem; font-weight: 800; letter-spacing: -0.5px; background: linear-gradient(to right, var(--accent), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
       .version-tag { font-size: 0.75rem; color: var(--text-muted); font-family: monospace; border: 1px solid var(--border); padding: 2px 6px; border-radius: 4px; background: rgba(0,0,0,0.2); }

        /* Layout */
       .container { max-width: 600px; margin: 0 auto; padding: 15px; }
       .card-panel { background: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 15px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Inputs */
       .row-group { display: flex; gap: 10px; margin-bottom: 12px; }
        label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 4px; display: block; font-weight: 600; }
        select, input { width: 100%; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); padding: 10px; border-radius: 8px; font-size: 0.95rem; outline: none; transition: 0.2s; }
        select:focus, input:focus { border-color: var(--accent); ring: 2px solid var(--accent); }

        /* Buttons */
       .btn-action { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 1rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px; }
       .btn-action:active { transform: scale(0.98); }
       .btn-opp { padding: 8px; background: transparent; border: 1px solid var(--border); color: var(--text-muted); border-radius: 6px; cursor: pointer; font-size: 0.85rem; font-weight: 500; }
       .btn-opp.active { background: var(--accent); color: white; border-color: var(--accent); }
       .opp-action-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }

        /* Range Chart */
       .chart-container { display: grid; grid-template-columns: repeat(13, 1fr); gap: 1px; background: #000; border-radius: 4px; overflow: hidden; border: 1px solid var(--border); margin-top: 10px; }
       .chart-cell { aspect-ratio: 1; font-size: 0.55rem; display: flex; align-items: center; justify-content: center; background-color: var(--c-fold); color: rgba(255,255,255,0.9); font-weight: 700; user-select: none; }
        
        /* Cards */
       .hand-display { display: flex; gap: 8px; justify-content: center; margin: 15px 0; perspective: 1000px; }
       .poker-card { width: 50px; height: 70px; background: var(--card-bg); border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 800; font-size: 1.4rem; cursor: pointer; position: relative; box-shadow: 0 2px 4px rgba(0,0,0,0.2); border: 1px solid #ccc; color: black; transition: transform 0.2s; }
       .poker-card.empty { background: rgba(125,125,125,0.1); border: 2px dashed var(--border); color: var(--text-muted); font-size: 1rem; box-shadow: none; }
       .poker-card.selected { border: 2px solid var(--accent); transform: translateY(-2px); }
       .suit-s,.suit-c { color: #1e293b; }
       .suit-h,.suit-d { color: #dc2626; }

        /* Advice Section (New) */
       .advice-box { background: rgba(0,0,0,0.2); border-left: 3px solid var(--accent); padding: 12px; margin-top: 15px; border-radius: 0 8px 8px 0; }
       .advantage-bar-container { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: 0.8rem; }
       .adv-label { width: 100px; color: var(--text-muted); text-align: right; }
       .adv-track { flex: 1; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; position: relative; }
       .adv-fill { height: 100%; transition: width 0.5s ease; }
        
        /* Navigation */
       .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--nav-bg); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 10px 0; z-index: 100; backdrop-filter: blur(10px); }
       .nav-item { color: var(--text-muted); text-align: center; flex: 1; opacity: 0.6; cursor: pointer; transition: 0.2s; }
       .nav-item.active { color: var(--accent); opacity: 1; transform: translateY(-2px); }
       .nav-icon { font-size: 1.2rem; display: block; margin-bottom: 2px; }
       .nav-text { font-size: 0.65rem; font-weight: 600; text-transform: uppercase; }

       .tab-content { display: none; animation: fadeIn 0.2s ease-out; }
       .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Modals */
       .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; justify-content: center; align-items: center; backdrop-filter: blur(2px); }
       .modal-content { background: var(--bg-panel); padding: 20px; border-radius: 12px; width: 90%; max-width: 340px; border: 1px solid var(--border); }
       .suit-row { display: flex; gap: 4px; margin-bottom: 4px; }
       .rank-btn { flex: 1; padding: 12px 0; background: var(--bg-body); border: 1px solid var(--border); border-radius: 4px; font-weight: bold; cursor: pointer; color: var(--text-main); }
        
        /* Utility */
       .hidden { display: none!important; }
       .badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: bold; }
       .bg-red { background: rgba(239,68,68,0.2); color: #ef4444; border: 1px solid #ef4444; }
       .bg-green { background: rgba(16,185,129,0.2); color: #10b981; border: 1px solid #10b981; }
       .bg-blue { background: rgba(59,130,246,0.2); color: #3b82f6; border: 1px solid #3b82f6; }
    </style>
</head>
<body>

<header>
    <h1>Poker God <span style="font-size:0.5em; opacity:0.8; vertical-align: top; color: var(--accent);">PRO</span></h1>
    <div class="version-tag">v6.0 GTO</div>
</header>

<div class="container">
    
    <div id="tab-ranges" class="tab-content active">
        <div class="card-panel">
            <div class="row-group">
                <div style="flex:1">
                    <label>Game Type</label>
                    <select id="gameMode" onchange="updateRanges()">
                        <option value="Cash">Cash (100bb)</option>
                        <option value="MTT">MTT (Var Stack)</option>
                    </select>
                </div>
                <div style="flex:1">
                    <label>Position</label>
                    <select id="heroPosition" onchange="updateRanges()">
                        <option value="UTG">UTG / EP</option>
                        <option value="MP">MP / HJ</option>
                        <option value="CO">Cutoff</option>
                        <option value="BTN">Button</option>
                        <option value="SB">SB</option>
                        <option value="BB">BB (Defend)</option>
                    </select>
                </div>
            </div>
            <div class="row-group">
                <div style="flex:1">
                    <label>Stack Depth (BB)</label>
                    <input type="number" id="stackDepth" value="100" oninput="updateRanges()" inputmode="numeric">
                </div>
                <div style="flex:1; display:flex; align-items:end;">
                    <span id="strategyLabel" class="badge bg-blue" style="width:100%; text-align:center; padding:10px;">Linear RFI</span>
                </div>
            </div>
        </div>

        <div class="card-panel" style="padding:10px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <label>GTO Matrix</label>
                <div style="font-size:0.7rem; color:var(--text-muted);" id="rangeInfo">--</div>
            </div>
            <div class="chart-container" id="rangeGrid"></div>
            <div style="display:flex; gap:10px; margin-top:8px; font-size:0.7rem; color:var(--text-muted); justify-content: center;">
                <span style="color:var(--c-allin)">â–  All-in</span>
                <span style="color:var(--c-raise)">â–  Raise</span>
                <span style="color:var(--c-call)">â–  Call</span>
                <span style="color:var(--c-fold)">â–  Fold</span>
            </div>
        </div>
    </div>

    <div id="tab-postflop" class="tab-content">
        <div class="card-panel">
            <label>My Hole Cards</label>
            <div class="hand-display">
                <div class="poker-card empty" id="card_h1" onclick="openSelector('h1')">+</div>
                <div class="poker-card empty" id="card_h2" onclick="openSelector('h2')">+</div>
            </div>
            
            <label>Board (Flop / Turn / River)</label>
            <div class="hand-display" style="gap:4px;">
                <div class="poker-card empty" style="width:45px; height:60px; font-size:1rem;" id="card_b1" onclick="openSelector('b1')"></div>
                <div class="poker-card empty" style="width:45px; height:60px; font-size:1rem;" id="card_b2" onclick="openSelector('b2')"></div>
                <div class="poker-card empty" style="width:45px; height:60px; font-size:1rem;" id="card_b3" onclick="openSelector('b3')"></div>
                <div class="poker-card empty" style="width:45px; height:60px; font-size:1rem;" id="card_b4" onclick="openSelector('b4')"></div>
                <div class="poker-card empty" style="width:45px; height:60px; font-size:1rem;" id="card_b5" onclick="openSelector('b5')"></div>
            </div>

            <div class="row-group" style="margin-top:15px;">
                <div style="flex:1">
                    <label>My Role</label>
                    <select id="pfRole">
                        <option value="IP_PFR">IP Aggressor (BTN vs BB)</option>
                        <option value="OOP_PFR">OOP Aggressor (SB vs BB)</option>
                        <option value="IP_Caller">IP Caller (BTN vs UTG)</option>
                        <option value="OOP_Caller">OOP Caller (BB vs BTN)</option>
                    </select>
                </div>
                <div style="flex:1">
                    <label>Opponent Action</label>
                    <div class="opp-action-grid" style="grid-template-columns: 1fr 1fr; margin-bottom:0;">
                        <button class="btn-opp active" onclick="setOppAction('Check', this)">Check</button>
                        <button class="btn-opp" onclick="setOppAction('Bet', this)">Bet</button>
                    </div>
                </div>
            </div>

            <button class="btn-action" onclick="analyzePostflop()">
                <span>âš¡ Analyze Situation</span>
            </button>

            <div id="analysisResult" class="hidden">
                <div style="margin-top:15px; display:flex; gap:5px;">
                    <span id="texWetness" class="badge bg-blue">Dry</span>
                    <span id="texDynamic" class="badge bg-blue">Static</span>
                    <span id="texHigh" class="badge bg-blue">A-High</span>
                </div>

                <div class="card-panel" style="background:rgba(0,0,0,0.2); margin-top:10px; border:none;">
                    <div class="advantage-bar-container">
                        <span class="adv-label">Range Adv.</span>
                        <div class="adv-track"><div id="rangeBar" class="adv-fill" style="width: 50%; background: var(--success);"></div></div>
                    </div>
                    <div class="advantage-bar-container">
                        <span class="adv-label">Nut Adv.</span>
                        <div class="adv-track"><div id="nutBar" class="adv-fill" style="width: 50%; background: var(--warning);"></div></div>
                    </div>
                </div>

                <div class="advice-box">
                    <div style="font-weight:bold; margin-bottom:5px; color:var(--accent);">GTO Strategy Suggestion:</div>
                    <div id="adviceText" style="font-size:0.9rem; line-height:1.5;"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="tab-trainer" class="tab-content">
        <div class="card-panel" style="text-align:center; padding:40px 20px;">
            <h3>GTO Trainer</h3>
            <p style="color:var(--text-muted)">Practice Preflop Ranges in Range Mode first.</p>
            <button class="btn-action" onclick="switchTab('ranges')">Go to Ranges</button>
        </div>
    </div>

</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('ranges', this)">
        <span class="nav-icon">ðŸ“Š</span><span class="nav-text">Ranges</span>
    </div>
    <div class="nav-item" onclick="switchTab('postflop', this)">
        <span class="nav-icon">ðŸ§ </span><span class="nav-text">Postflop</span>
    </div>
    <div class="nav-item" onclick="switchTab('trainer', this)">
        <span class="nav-icon">ðŸŽ¯</span><span class="nav-text">Trainer</span>
    </div>
</div>

<div class="modal" id="cardModal">
    <div class="modal-content">
        <h3 style="margin-top:0; text-align:center;">Select Card</h3>
        <div id="suit-s" class="suit-row"></div>
        <div id="suit-h" class="suit-row"></div>
        <div id="suit-c" class="suit-row"></div>
        <div id="suit-d" class="suit-row"></div>
        <button onclick="closeSelector()" class="btn-action" style="background:var(--c-fold); margin-top:10px;">Cancel</button>
        <button onclick="clearCard()" class="btn-action" style="background:transparent; border:1px solid var(--danger); color:var(--danger); margin-top:5px;">Clear Card</button>
    </div>
</div>

<script>
/**
 * POKER GOD PRO v6.0 CORE ENGINE
 * Implements Multi-depth Preflop GTO & Heuristic Postflop Analysis
 */

// --- 1. PREFLOP GTO DATABASE ---
// Compressed Range Strings for Key Depths
const GTO_DB = {
    "Cash": {
        "100bb": {
            "UTG": "55+,A2s+,K9s+,Q9s+,J9s+,T8s+,98s,87s,76s,AJo+,KQo",
            "MP": "44+,A2s+,K9s+,Q9s+,J9s+,T8s+,97s+,87s,76s,65s,ATo+,KJo+,QJo",
            "CO": "22+,A2s+,K5s+,Q8s+,J8s+,T8s+,97s+,86s+,75s+,65s,54s,A9o+,KTo+,QTo+,JTo",
            "BTN": "22+,A2s+,K2s+,Q2s+,J4s+,T5s+,95s+,84s+,74s+,63s+,53s+,43s,A2o+,K5o+,Q8o+,J8o+,T8o+,97o+,87o",
            "SB": "22+,A2s+,K2s+,Q5s+,J7s+,T7s+,96s+,85s+,75s+,64s+,53s+,43s,A2o+,K8o+,Q9o+,J9o+,T9o,98o",
            "BB": "Top20%,22-AA" // BB Defend is reactionary, simplified here
        }
    },
    "MTT": {
        "15bb": { // Push/Fold (Nash)
            "UTG": "77+,ATs+,KQs,AJo+,KQo",
            "MP": "55+,A8s+,KJs+,QJs,JTs,ATo+,KJo+,QJo",
            "CO": "22+,A2s+,K9s+,Q9s+,J9s+,T8s+,98s,87s,A8o+,KTo+,QTo+,JTo",
            "BTN": "22+,A2s+,K2s+,Q2s+,J5s+,T6s+,96s+,85s+,75s+,65s,54s,A2o+,K5o+,Q8o+,J8o+,T8o+,98o",
            "SB": "22+,A2s+,K2s+,Q2s+,J2s+,T4s+,95s+,85s+,74s+,64s+,53s+,43s,A2o+,K2o+,Q5o+,J7o+,T7o+,97o+,87o"
        },
        "20bb": { // Min-Raise / Fold
            "UTG": "55+,A2s+,KTs+,QTs+,JTs,AJo+,KQo", 
            "MP": "44+,A2s+,K9s+,Q9s+,J9s+,T9s,ATo+,KJo+,QJo",
            "CO": "22+,A2s+,K5s+,Q8s+,J8s+,T8s+,97s+,87s,76s,A9o+,KTo+,QTo+,JTo",
            "BTN": "22+,A2s+,K2s+,Q4s+,J6s+,T6s+,96s+,85s+,75s+,65s,54s,A2o+,K8o+,Q9o+,J9o+,T9o,98o",
            "SB": "22+,A2s+,K2s+,Q2s+,J5s+,T6s+,96s+,86s+,76s,65s,54s,A7o+,K9o+,QTo+,JTo"
        },
        "40bb": { // Reshovable Stack
            "UTG": "66+,A5s,A9s+,KJs+,QJs,JTs,ATo+,KQo",
            "BTN": "22+,A2s+,K4s+,Q6s+,J7s+,T7s+,97s+,86s+,76s,65s,54s,A2o+,K9o+,Q9o+,J9o+,T9o"
        }
    }
};

// --- 2. GLOBAL STATE ---
let state = {
    h1: null, h2: null,
    b1: null, b2: null, b3: null, b4: null, b5: null,
    oppAction: 'Check',
    targetSelector: null
};
const RANKS =;
const SUITS = [
    {id:'s', s:'â™ ', c:'black'}, 
    {id:'h', s:'â™¥', c:'red'}, 
    {id:'c', s:'â™£', c:'green'}, 
    {id:'d', s:'â™¦', c:'blue'}
];

// --- 3. INIT & UI LOGIC ---
window.onload = () => {
    generateRangeGrid();
    generateCardSelector();
    updateRanges(); // Initial render
};

function switchTab(tabId, el) {
    document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
    document.getElementById('tab-'+tabId).classList.add('active');
    if(el) {
        document.querySelectorAll('.nav-item').forEach(d => d.classList.remove('active'));
        el.classList.add('active');
    }
}

// --- 4. PREFLOP LOGIC ---
function generateRangeGrid() {
    const grid = document.getElementById('rangeGrid');
    grid.innerHTML = '';
    for (let i = 0; i < 13; i++) {
        for (let j = 0; j < 13; j++) {
            let cell = document.createElement('div');
            cell.className = 'chart-cell';
            let hand = "", type = "";
            if (i === j) { hand = RANKS[i] + RANKS[j]; type = "pair"; }
            else if (i < j) { hand = RANKS[i] + RANKS[j] + "s"; type = "suited"; }
            else { hand = RANKS[j] + RANKS[i] + "o"; type = "offsuit"; }
            
            cell.innerText = hand;
            cell.dataset.hand = hand;
            cell.dataset.r1 = 14 - i; // Numeric rank for logic
            cell.dataset.r2 = 14 - j;
            cell.dataset.type = type;
            grid.appendChild(cell);
        }
    }
}

function updateRanges() {
    const mode = document.getElementById('gameMode').value;
    const pos = document.getElementById('heroPosition').value;
    const stack = parseInt(document.getElementById('stackDepth').value);
    
    // Determine Strategy Mode based on Stack
    let stratKey = "100bb";
    let strategyName = "Linear RFI";
    let colorClass = "bg-blue";

    if (mode === 'MTT') {
        if (stack <= 16) { stratKey = "15bb"; strategyName = "Push / Fold (Nash)"; colorClass = "bg-red"; }
        else if (stack <= 22) { stratKey = "20bb"; strategyName = "Min-Raise / Fold"; colorClass = "bg-warning"; }
        else if (stack <= 50) { stratKey = "40bb"; strategyName = "Linear / Reshove"; colorClass = "bg-green"; }
        else { stratKey = "40bb"; strategyName = "Deep Stack (Use 40bb+)"; colorClass = "bg-blue"; }
    } else {
        stratKey = "100bb";
        strategyName = "Cash 100bb (Rake Adj.)";
    }

    // UI Update
    document.getElementById('strategyLabel').innerText = `${strategyName}`;
    document.getElementById('strategyLabel').className = `badge ${colorClass}`;
    document.getElementById('rangeInfo').innerText = `${mode} ${stack}BB - ${pos}`;

    // Get Range String (Fallback mechanism)
    let rangeStr = "";
    try {
        // Try exact match
        if (GTO_DB[mode][stratKey] && GTO_DB[mode][stratKey][pos]) {
            rangeStr = GTO_DB[mode][stratKey][pos];
        } 
        // Fallback for missing keys (e.g. MP in 40bb might use 20bb logic if not defined)
        else if (GTO_DB[mode]["20bb"] && GTO_DB[mode]["20bb"][pos]) {
            rangeStr = GTO_DB[mode]["20bb"][pos]; 
        }
    } catch(e) { console.log("DB Error"); }

    // Color Grid
    document.querySelectorAll('.chart-cell').forEach(cell => {
        const hand = cell.dataset.hand;
        const isIncluded = checkHandInRange(hand, rangeStr);
        
        if (isIncluded) {
            // PushFold mode = Red (Allin), otherwise Green (Raise)
            if (strategyName.includes("Push")) cell.style.background = "var(--c-allin)";
            else cell.style.background = "var(--c-raise)";
            cell.style.color = "#fff";
        } else {
            cell.style.background = "var(--c-fold)";
            cell.style.color = "rgba(255,255,255,0.3)";
        }
    });
}

function checkHandInRange(hand, rangeStr) {
    if (!rangeStr) return false;
    let parts = rangeStr.split(',');
    
    // Parse current hand (e.g., "AKs")
    let r1Char = hand;
    let r2Char = hand[1];
    let typeChar = hand.length > 2? hand[2] : ''; 
    let r1Val = 14 - RANKS.indexOf(r1Char);
    let r2Val = 14 - RANKS.indexOf(r2Char);
    
    for (let part of parts) {
        part = part.trim();
        if (part === hand) return true;
        
        // Handle "22+"
        if (part.includes('+')) {
            let base = part.replace('+', '');
            let baseR1 = 14 - RANKS.indexOf(base);
            let baseR2 = 14 - RANKS.indexOf(base[1]);
            let baseType = base.length > 2? base[2] : '';
            
            // Pairs (e.g. 77+)
            if (baseR1 === baseR2 && r1Val === r2Val) {
                if (r1Val >= baseR1) return true;
            }
            // Non-pairs (e.g. AJs+) -> implies AJs, AQs, AKs
            else if (typeChar === baseType && r1Val === baseR1) {
                if (r2Val >= baseR2) return true;
            }
        }
    }
    return false;
}

// --- 5. POSTFLOP ENGINE (HEURISTIC) ---

function openSelector(id) {
    state.targetSelector = id;
    document.getElementById('cardModal').style.display = 'flex';
}
function closeSelector() {
    document.getElementById('cardModal').style.display = 'none';
}
function clearCard() {
    state = null;
    updateCardDisplay(state.targetSelector, null);
    closeSelector();
}
function generateCardSelector() {
    SUITS.forEach(s => {
        let row = document.getElementById('suit-' + s.id);
        RANKS.forEach(r => {
            let btn = document.createElement('div');
            btn.className = 'rank-btn';
            btn.style.color = s.c;
            btn.innerText = r + s.s;
            btn.onclick = () => selectCard(r, s);
            row.appendChild(btn);
        });
    });
}
function selectCard(rank, suitObj) {
    state = { rank: rank, suit: suitObj.id, displaySuit: suitObj.s, color: suitObj.c };
    updateCardDisplay(state.targetSelector, state);
    closeSelector();
}
function updateCardDisplay(id, card) {
    let el = document.getElementById('card_' + id);
    if (card) {
        el.className = 'poker-card selected';
        el.style.color = card.color;
        el.innerHTML = `<div>${card.rank}</div><div style="font-size:1.8rem">${card.displaySuit}</div>`;
    } else {
        el.className = 'poker-card empty';
        el.innerHTML = '+';
    }
}
function setOppAction(action, btn) {
    state.oppAction = action;
    document.querySelectorAll('.btn-opp').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

// --- CORE ANALYTIC ALGORITHM ---
function analyzePostflop() {
    // 1. Validate Input
    let board = [state.b1, state.b2, state.b3, state.b4, state.b5].filter(x => x);
    if (board.length < 3) { alert("Please input at least 3 flop cards."); return; }
    
    // 2. Analyze Board Texture
    let texture = getBoardTexture(board);
    
    // 3. Determine Context (Simplification: Based on PF Role)
    const role = document.getElementById('pfRole').value;
    const isIP = role.includes('IP');
    const isAggressor = role.includes('PFR');
    
    // 4. Calculate Heuristic Advantages
    let rangeAdv = 50; // Neutral 50%
    let nutAdv = 50;
    
    // -- Texture Logic --
    // High cards favor Aggressor (usually)
    if (texture.highCardCount >= 2) {
        if (isAggressor) { rangeAdv += 15; nutAdv += 10; }
        else { rangeAdv -= 10; nutAdv -= 5; }
    }
    // Low connected boards favor Caller (Big Blind typically)
    if (texture.isConnected && texture.highCardCount === 0) {
        if (!isAggressor) { rangeAdv += 10; nutAdv += 20; } // Caller has more 2pair/straights
        else { rangeAdv -= 10; nutAdv -= 20; }
    }
    // Monotone boards neutralize range advantage, cuts betting freq
    if (texture.isMonotone) {
        rangeAdv = 50; // Equity runs close
        nutAdv = 50;   // Anybody can have a flush
    }

    // 5. Generate Strategy Text
    let strategy = "";
    
    if (texture.isMonotone) {
        strategy = `<b>Monotone Board:</b> Extreme caution required. High checking frequency for both players. <br>ðŸ”¹ <b>Bet Sizing:</b> If betting, use small sizing (25-33% pot) to deny equity cheaply. Avoid large bluffs.`;
    } else if (texture.isPaired) {
        strategy = `<b>Paired Board:</b> Usually dry. <br>ðŸ”¹ <b>Strategy:</b> Frequent C-Bets (small size) work well if you are the aggressor as it's hard for opponent to hit trips.`;
    } else if (texture.isDry && isAggressor) {
        strategy = `<b>Dry/Static Board:</b> You likely have Range Advantage. <br>ðŸ”¹ <b>Action:</b> High Frequency C-Bet. <br>ðŸ”¹ <b>Sizing:</b> Small (33% Pot). You want to make them fold trash hands.`;
    } else if (texture.isWet &&!isAggressor) {
        strategy = `<b>Wet/Dynamic Board:</b> This hits the caller's range (sets, 2-pair, straights). <br>ðŸ”¹ <b>Action:</b> Don't fold top pair easily, but be wary of aggression. Check-Raise is powerful here if you have draws.`;
    } else if (texture.isWet && isAggressor) {
        strategy = `<b>Dangerous Board:</b> Opponent has Nut Advantage (Sets/Straights). <br>ðŸ”¹ <b>Action:</b> Check back medium strength hands. <br>ðŸ”¹ <b>Polarized:</b> If betting, bet BIG (66-75%) with strong hands and strong draws only.`;
    } else {
        strategy = `<b>Standard Spot:</b> Play solid poker. Bet your strong hands for value, bluff your good draws.`;
    }

    // 6. Update UI
    document.getElementById('analysisResult').classList.remove('hidden');
    
    // Update Tags
    document.getElementById('texWetness').innerText = texture.isWet? "ðŸŒŠ Wet" : "ðŸŒµ Dry";
    document.getElementById('texDynamic').innerText = texture.isDynamic? "âš¡ Dynamic" : "ðŸ—¿ Static";
    document.getElementById('texHigh').innerText = texture.highCardCount >= 2? "High Card" : "Low/Mid";
    
    // Update Bars
    updateBar('rangeBar', rangeAdv);
    updateBar('nutBar', nutAdv);
    
    // Update Text
    document.getElementById('adviceText').innerHTML = strategy;
}

function getBoardTexture(cards) {
    const ranks = cards.map(c => 14 - RANKS.indexOf(c.rank)); // 14=A, 2=2
    const suits = cards.map(c => c.suit);
    
    // 1. Monotone
    const suitCounts = {};
    suits.forEach(s => suitCounts[s] = (suitCounts[s] |

| 0) + 1);
    const isMonotone = Object.values(suitCounts).some(c => c >= 3);
    
    // 2. Paired
    const uniqueRanks = new Set(ranks);
    const isPaired = uniqueRanks.size < cards.length;
    
    // 3. High Cards (Broadway: T,J,Q,K,A => 10,11,12,13,14)
    const highCardCount = ranks.filter(r => r >= 10).length;
    
    // 4. Connectedness (Simple gap check)
    let sorted = [...ranks].sort((a,b)=>a-b);
    let gaps = 0;
    for(let i=0; i<sorted.length-1; i++) {
        gaps += (sorted[i+1] - sorted[i] - 1);
    }
    // E.g., 7,8,9 => gaps=0 (Very connected). 2,7,Q => gaps huge.
    // Heuristic: If gaps are small relative to card count, it's connected.
    const isConnected = gaps <= 2 && sorted.length >= 3; 
    
    // 5. Classification
    const isWet = isConnected |

| isMonotone |
| (highCardCount >= 2 && isConnected);
    const isDynamic = isWet; // Simplification: Wet boards are usually dynamic
    
    return { isMonotone, isPaired, highCardCount, isConnected, isWet, isDynamic, isDry:!isWet };
}

function updateBar(id, val) {
    // Clamp between 10 and 90 for visual safety
    val = Math.max(10, Math.min(90, val));
    document.getElementById(id).style.width = val + "%";
    // Change color based on advantage
    if (val > 55) document.getElementById(id).style.background = "var(--success)";
    else if (val < 45) document.getElementById(id).style.background = "var(--danger)";
    else document.getElementById(id).style.background = "var(--warning)";
}

</script>
</body>
</html>
